<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pivot Table with Drill Down from GitHub</title>
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- DataTables JS -->
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <style>
        table.dataTable tbody tr.child {
            background-color: #f9f9f9;
            display: none;
        }
        .child-row {
            background-color: #e6f7ff;
        }
    </style>
</head>
<body>
    <h1>Interactive Pivot Table with Drill Down from GitHub</h1>
    <table id="example" class="display">
        <thead>
            <tr>
                <th>平台</th>
                <th>7.规格/型号</th>
                <th>求和项:8.数量/套</th>
                <th>求和项:11.订单行金额</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data will be loaded here from GitHub -->
        </tbody>
    </table>

    <script>
        $(document).ready(function() {
            // GitHub raw file URL (updated to your Raw URL)
            const githubFileUrl = 'https://raw.githubusercontent.com/youyi666/youyi666.github.io/refs/heads/main/%E9%94%80%E9%87%8F%E8%A1%A82.csv'; 

            // Function to get file content from GitHub
            function getGitHubFileContent(fileUrl) {
                return fetch(fileUrl)
                    .then(response => response.text())
                    .then(csvData => {
                        console.log("CSV Data Loaded: ", csvData);  // Log the CSV data to check
                        return csvData;
                    });
            }

            // Function to parse CSV and load into DataTable
            function loadCSVData(csvData) {
                console.log("Parsing CSV Data...");

                const rows = csvData.split('\n').map(row => row.split(','));
                console.log("Parsed Rows: ", rows);  // Log the parsed rows

                const tableData = rows.slice(1).map(row => [row[0], row[1], row[3], row[4]]);
                console.log("Table Data: ", tableData);  // Log the final data to be displayed
                return tableData;
            }

            // Fetch data from GitHub and initialize table
            getGitHubFileContent(githubFileUrl).then(csvData => {
                const tableData = loadCSVData(csvData);
                
                // Populate the table with data
                tableData.forEach(row => {
                    $('#example tbody').append(`<tr><td>${row[0]}</td><td>${row[1]}</td><td>${row[2]}</td><td>${row[3]}</td></tr>`);
                });

                // Initialize DataTable
                var table = $('#example').DataTable({
                    "dom": 'Bfrtip',
                    "buttons": [
                        'copy', 'csv', 'excel', 'pdf', 'print'
                    ],
                    "rowGroup": {
                        dataSrc: 0 // Group by Platform
                    },
                    "order": [[0, 'asc']]
                });

                // Add drill down functionality
                $('#example tbody').on('click', 'tr', function () {
                    var tr = $(this);
                    var row = table.row(tr);

                    if (row.child.isShown()) {
                        row.child.hide();
                        tr.removeClass('shown');
                    } else {
                        var data = row.data();
                        var platform = data[0];
                        var model = data[1];

                        var childData = tableData.filter(d => d[0] === platform);
                        var childHtml = '<table class="child-row"><thead><tr><th>平台</th><th>7.规格/型号</th><th>求和项:8.数量/套</th><th>求和项:11.订单行金额</th></tr></thead><tbody>';
                        childData.forEach(d => {
                            childHtml += `<tr><td>${d[0]}</td><td>${d[1]}</td><td>${d[2]}</td><td>${d[3]}</td></tr>`;
                        });
                        childHtml += '</tbody></table>';

                        row.child(childHtml).show();
                        tr.addClass('shown');
                    }
                });
            }).catch(error => {
                console.error("Error fetching file from GitHub: ", error);
            });
        });
    </script>
</body>
</html>
